(function(){"use strict";(function(){if(window.BuzzwaldLoader){console.warn("Buzzwald loader already initialized");return}window.BuzzwaldLoader=!0;const r="https://cdn.jsdelivr.net/gh/"+"StructuredLabs/buzzwald-client",u=r+"@latest/dist/version.json",c=r+"@latest/dist/buzzwald-widget.js",d="buzzwald_widget_version",w=5*60*1e3;function f(t,e){try{const a=localStorage.getItem(t);if(!a)return null;const o=JSON.parse(a);return Date.now()-o.timestamp>e?(localStorage.removeItem(t),null):o.value}catch{return null}}function z(t,e){try{localStorage.setItem(t,JSON.stringify({value:e,timestamp:Date.now()}))}catch{}}function g(t,e=5e3){return new Promise((a,o)=>{const n=new AbortController,E=setTimeout(()=>{n.abort(),o(new Error("Request timeout"))},e);fetch(t,{signal:n.signal,cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}}).then(i=>{if(clearTimeout(E),!i.ok)throw new Error(`HTTP ${i.status}`);return i}).then(a).catch(o)})}async function m(){const t=f(d,w);if(t)return t;try{const a=await(await g(u)).json();return z(d,a),a}catch(e){return console.warn("Failed to fetch version info:",e),null}}function l(t){return new Promise((e,a)=>{const o=document.querySelector("script[data-buzzwald-widget]");if(o){if(o.dataset.loaded==="true"){e();return}o.addEventListener("load",e),o.addEventListener("error",a);return}const n=document.createElement("script");n.src=t,n.type="text/javascript",n.async=!0,n.crossOrigin="anonymous",n.dataset.buzzwaldWidget="true",n.onload=function(){n.dataset.loaded="true",e()},n.onerror=function(){a(new Error("Failed to load widget script"))},document.head.appendChild(n)})}async function s(){try{const t=await m();let e;t&&t.version&&t.timestamp?e=`${r}@latest/dist/buzzwald-widget.js?v=${t.version}&t=${t.timestamp}`:e=`${c}?t=${Date.now()}`,await l(e),console.log("Buzzwald widget loaded successfully")}catch(t){console.error("Failed to load Buzzwald widget:",t);try{await l(`${c}?t=${Date.now()}`),console.log("Buzzwald widget loaded with fallback")}catch(e){console.error("Fallback widget load also failed:",e),window.BuzzwaldConfig&&window.BuzzwaldConfig.onError&&window.BuzzwaldConfig.onError("Failed to load widget")}}}function h(){return new Promise(t=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()})}async function C(){await h(),setTimeout(s,100);let t;window.BuzzwaldConfig||(t=setInterval(()=>{window.BuzzwaldConfig&&(clearInterval(t),s())},100),setTimeout(()=>{t&&clearInterval(t)},1e4))}C().catch(console.error)})()})();
